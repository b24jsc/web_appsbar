<?xml version="1.0" encoding="UTF-8" ?>

<templates xml:space="preserve">
	<t t-name="NestedMenuTree">
		<li t-attf-class="b24_menu_item {{ menu.childrenTree?.length ? 'has-children' : '' }}">
			
			<!-- Nếu có children: hiển thị toggle -->
			<div t-if="menu.childrenTree?.length"
				class="b24_menu_title"
				t-att-data-menu-id="menu.id"
				t-on-click.prevent="() => this.toggleMenu(menu.id)">
				<span class="b24_menu_name"><t t-out="menu.name" /></span>
				<i t-attf-class="fa {{ this.isMenuOpen(menu.id) ? 'fa-chevron-down' : 'fa-chevron-right' }} b24_toggle_icon"></i>
			</div>

			<!-- Nếu không có children: render luôn link menu -->
			<a t-if="!menu.childrenTree?.length"
				href="#"
				t-att-title="menu.name"
				t-att-data-menu-id="menu.id"
				t-att-data-action-id="menu.actionID"
				t-on-click.prevent="() => this._menuClicked(menu)"
				t-attf-class="b24_menu_leaf {{ menu.actionID === this.state.currentMenu?.actionID ? 'active' : '' }}">
				<t t-out="menu.name" />
			</a>

			<!-- Chỉ render children nếu menu cha đang mở -->
			<t t-if="this.isMenuOpen(menu.id)">
				<ul class="b24_submenu_list">
					<t t-foreach="menu.childrenTree" t-as="child" t-key="child.id">
						<t t-call="NestedMenuTree">
							<t t-set="menu" t-value="child" />
						</t>
					</t>
				</ul>
			</t>
		</li>
	</t>

	<t t-name="web_appsbar.AppsBar">
		<div class="b24_apps_sidebar_panel">
			<div class="b24_apps_sidebar">
				<div class="sidebar_header">
					<div class="b24_sidebar_toggle" t-on-click.prevent="toggleSidebar">
						<img class="company_icon" t-att-src="sidebarImageUrl" alt="Logo"/>
						<span class="company_name" > 
							<t t-esc="companyName"/>
						</span>
					</div>
					<div class="search_space" t-on-click="openSearch">
						<i class="fa fa-search search_icon" role="button" title="Search"></i>
						<span class="search_text">Search</span>
						<div>
							<span class="shortcut_text">Ctrl</span>
							<span class="shortcut_text">K</span>
						</div>
					</div>
				</div>

				<ul class="b24_apps_sidebar_menu">
					<t t-foreach="this.appMenuService.getAppsMenuItems()" t-as="app" t-key="app.id">
						<li t-attf-class="nav-item {{ app.id === this.appMenuService.getCurrentApp()?.id ? 'active' : '' }}">
							<div class="b24_app_item" >
								<a 
									t-on-click.prevent="() => this._onAppClick(app)"
									t-att-data-action-id="app.actionID"
									t-att-title="app.label"
									class="nav-link" 
									role="menuitem">
									<img 
										t-if="app.webIconData" 
										class="b24_apps_sidebar_icon" 
										t-att-src="app.webIconData"
									/>
									<img  
										t-else="" 
										class="b24_apps_sidebar_icon" 
										src="/base/static/description/icon.png"
									/>
									<span class="b24_apps_sidebar_name">
										<t t-out="app.label"/>
									</span>
								</a>
								<div 
									class="b24_app_toggle_area"
									t-on-click.prevent="() => this.toggleAppMenu(app.id)">
									<i t-attf-class="fa {{ this.isMenuOpen(app.id) ? 'fa-chevron-down' : 'fa-chevron-right' }} b24_toggle_icon"></i>
								</div>
							</div>

							<ul t-if="this.appMenuService.getMenuAsTree(app.id)?.childrenTree &amp;&amp; this.isMenuOpen(app.id)" class="b24_menus_sidebar">
								<t t-set="tree" t-value="this.appMenuService.getMenuAsTree(app.id)" />
								<t t-foreach="tree.childrenTree" t-as="menu" t-key="menu.id">
									<t t-call="NestedMenuTree">
										<t t-set="menu" t-value="menu" />
									</t>
								</t>
							</ul>
						</li>
					</t>
				</ul>
				<div class="sidebar_footer">
					<a href="https://www.b24.vn/" target="_blank" 
						class="b24_company">
						<img class="company_icon" t-att-src="defaultCompanyImage" alt="Logo"/>
						<div>
							<span class="company_name">B24</span><br/>
							<small class="author_text">Powered by B24</small>
						</div>
					</a>

					<a href="https://www.b24.vn/helpdesk/" target="_blank" 
						class="help_space" >
						<i class="fa fa-question-circle question_icon" role="button" title="Help"></i>
					</a>
				</div>
			</div>
			<!-- <div class="b24_sidebar_resizer" t-on-mousedown="(ev) => this.startResizing(ev)">
				<i class="fa fa-bars b24_resizer_icon" 
					role="button"
					title="Resize Sidebar">
				</i>
			</div> -->
		</div>
	</t>
	
</templates>
